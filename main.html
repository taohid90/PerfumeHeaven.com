<!doctype html>
<html lang="en">
<head>
    <title>Toffe - Credit Bongo Flix</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

    <style>
        :root {
            --primary-bg: #101010;
            --secondary-bg: #1a1a1a;
            --text-color: #e0e0e0;
            --accent-color: #00bcd4;
            --card-bg: #181818;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }

        /* অরোরা ব্যাকগ্রাউন্ড */
        .aurora-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            background: radial-gradient(ellipse at top, rgba(0, 188, 212, 0.15), transparent 60%),
                        radial-gradient(ellipse at bottom, rgba(76, 175, 80, 0.1), transparent 70%);
            z-index: -1;
            animation: aurora-flow 20s ease-in-out infinite alternate;
        }
        @keyframes aurora-flow {
            from { transform: rotate(0deg) scale(1.5); }
            to { transform: rotate(15deg) scale(1.8); }
        }

        /* গ্লাস-মরফিজম নেভিগেশন বার */
        .navbar-custom {
            background: rgba(16, 16, 16, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75rem 2rem;
        }
        .navbar-brand img { width: 110px; }
        .search-wrapper { position: relative; width: 100%; max-width: 450px; }
        .search-icon { position: absolute; left: 1.25rem; top: 50%; transform: translateY(-50%); color: #888; }
        .search-input {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border-radius: 50px;
            padding-left: 3rem;
            transition: all 0.3s ease;
        }
        .search-input:focus {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(0, 188, 212, 0.2);
        }
        .main-content { padding-top: 120px; }
        
        /* ক্যাটাগরি ফিল্টার */
        .category-filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .filter-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            padding: 0.5rem 1.25rem;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .filter-btn:hover { background: rgba(255, 255, 255, 0.1); }
        .filter-btn.active { background-color: var(--accent-color); color: var(--primary-bg); border-color: var(--accent-color); }

        /* চ্যানেল কার্ড ডিজাইন */
        .channel-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .channel-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3), 0 0 0 2px var(--accent-color);
        }
        .card-img-wrapper { aspect-ratio: 16 / 9; background-color: #222; display: flex; align-items: center; justify-content: center; }
        .card-img { width: 100%; height: 100%; object-fit: contain; }
        .card-body { padding: 0.75rem; }
        .card-title { font-weight: 600; font-size: 0.9rem; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .loader-wrapper { display: flex; justify-content: center; align-items: center; height: 300px; width: 100%; }
        .loader {
            width: 50px;
            aspect-ratio: 1;
            border-radius: 50%;
            border: 8px solid;
            border-color: #555 #0000;
            animation: l1 1s infinite;
        }
        @keyframes l1 { to { transform: rotate(.5turn) } }
    </style>
</head>
<body>

<div class="aurora-background"></div>

<nav class="navbar navbar-expand-lg navbar-custom fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><img src="https://toffeelive.com/logo.svg" alt="Bongo Flix"/></a>
    <div class="mx-auto search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="form-control search-input" placeholder="Search channels..." id="inpSearchTV" autocomplete="off">
    </div>
    <div class="d-none d-lg-block"><a class="btn filter-btn active" href="#">Login</a></div>
  </div>
</nav>

<div class="container-fluid main-content px-4">
    <div class="category-filters" id="categoryFilters">
        <button class="filter-btn active" data-category="All">All</button>
        <button class="filter-btn" data-category="Sports">Sports</button>
        <button class="filter-btn" data-category="Entertainment">Entertainment</button>
        <button class="filter-btn" data-category="News">News</button>
        <button class="filter-btn" data-category="Movies">Movies</button>
    </div>
    <div id="tvsGrid" class="row g-4">
        <div class="loader-wrapper"><div class="loader"></div></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, where } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAb8YsPMOY53GxiycCL6G0MPZdgWe3nnyY",
        authDomain: "movie-92659.firebaseapp.com",
        databaseURL: "https://movie-92659-default-rtdb.firebaseio.com",
        projectId: "movie-92659",
        storageBucket: "movie-92659.firebasestorage.app",
        messagingSenderId: "1090734362509",
        appId: "1:1090734362509:web:86be5583f6e8fcfdfa77c4",
        measurementId: "G-XF1TEP0DSJ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const channelsCollection = collection(db, "channels");
    
    const tvsGrid = document.getElementById('tvsGrid');
    const searchInput = document.getElementById('inpSearchTV');
    const categoryFilters = document.getElementById('categoryFilters');
    let allChannels = []; // Cache all channels for faster filtering

    const renderChannels = (channels) => {
        if (!channels || channels.length === 0) {
            tvsGrid.innerHTML = '<h3 class="text-center text-muted w-100 py-5">No channels found.</h3>';
            return;
        }
        
        let lmtl = '';
        channels.forEach((channel, index) => {
            lmtl += `
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-6">
                    <div class="channel-card" style="animation-delay: ${index * 30}ms" onclick="playlivetv('${channel.id}')" title="Watch ${channel.title} Live">
                        <div class="card-img-wrapper"><img class="card-img" src="${channel.logo}" alt="${channel.title}"/></div>
                        <div class="card-body"><h5 class="card-title">${channel.title}</h5></div>
                    </div>
                </div>`;
        });
        tvsGrid.innerHTML = lmtl;
    };
    
    const fetchAndCacheChannels = async () => {
        try {
            tvsGrid.innerHTML = '<div class="loader-wrapper"><div class="loader"></div></div>';
            const q = query(channelsCollection, orderBy("title"));
            const snapshot = await getDocs(q);
            allChannels = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderChannels(allChannels);
        } catch (error) {
            console.error("Error loading channels: ", error);
            tvsGrid.innerHTML = '<h3 class="text-center text-danger w-100 py-5">Error: Could not load channels.</h3>';
        }
    };

    const filterChannels = (category) => {
        document.querySelector('.filter-btn.active').classList.remove('active');
        document.querySelector(`.filter-btn[data-category="${category}"]`).classList.add('active');
        
        if (category === 'All') {
            renderChannels(allChannels);
        } else {
            const filtered = allChannels.filter(ch => ch.category === category);
            renderChannels(filtered);
        }
    };
    
    let debounceTimer;
    const searchTVlist = () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(async () => {
            const searchText = searchInput.value.trim().toLowerCase();
            document.querySelector('.filter-btn.active').classList.remove('active');
            document.querySelector('.filter-btn[data-category="All"]').classList.add('active');

            if (!searchText) {
                renderChannels(allChannels);
                return;
            }
            
            const filtered = allChannels.filter(ch => ch.search_keywords.includes(searchText));
            renderChannels(filtered);
        }, 300);
    };
    
    window.playlivetv = (channelId) => { window.location.href = `player.html?id=${channelId}`; };

    searchInput.addEventListener('keyup', searchTVlist);
    categoryFilters.addEventListener('click', (e) => {
        if (e.target.classList.contains('filter-btn')) {
            filterChannels(e.target.dataset.category);
        }
    });
    
    fetchAndCacheChannels();
</script>
</body>
</html>
